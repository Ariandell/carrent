<!DOCTYPE html>
<html lang="uk" class="dark scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-config="PROJECT_NAME">FPV Racer - Access</title>

    <!-- Prevent Caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/tailwind_config.js"></script>
    <link href="./css/antigravity.css?v=108" rel="stylesheet">

    <!-- Core Config -->
    <script src="js/config.js?v=99"></script>
    <script src="js/lang.js?v=100"></script>

    <!-- Visual Engines -->
    <script src="js/prism.js?v=2" defer></script>
    <script src="js/fluid.js?v=1" defer></script>

    <style>
        /* Gravity Text Animation Styles */
        .char-wrapper {
            display: inline-block;
            position: relative;
            white-space: pre;
        }

        .fly-out {
            animation: gravityFlyOut 0.5s cubic-bezier(0.5, 0, 1, 1) forwards;
            position: absolute;
            /* Prevent layout shift on exit */
            pointer-events: none;
        }

        .fly-in {
            animation: gravityFlyIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes gravityFlyOut {
            0% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg);
            }

            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) rotate(var(--r));
                filter: blur(5px);
            }
        }

        @keyframes gravityFlyIn {
            0% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) rotate(var(--r));
                filter: blur(10px);
            }

            100% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg);
                filter: blur(0);
            }
        }

        /* Fix Form Overlap */
        .auth-form {
            transition: opacity 0.3s ease-in-out, visibility 0.3s;
        }

        .auth-form.hidden-form {
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            /* Ensure it doesn't take focus or interaction */
            z-index: 0;
        }

        .auth-form.active-form {
            opacity: 1;
            pointer-events: auto;
            visibility: visible;
            z-index: 10;
        }
    </style>
</head>

<body
    class="overflow-hidden selection:bg-neutral-500 selection:text-white flex flex-col items-center justify-center min-h-screen relative font-sans">

    <!-- Background Layer -->
    <div id="bg-layer" class="fixed inset-0 z-0 bg-[#050505]"></div>

    <!-- Return Home -->
    <a href="index.html"
        class="absolute top-8 left-8 text-[10px] font-mono opacity-40 hover:opacity-100 transition-opacity z-50 flex items-center gap-2 uppercase tracking-widest cursor-pointer text-white">
        <span>&larr; BACK</span>
    </a>

    <!-- Main Container -->
    <main class="relative z-10 w-full max-w-lg px-6 flex flex-col items-center">

        <!-- Header: Dynamic Gravity Text (Font Manifesto to match Landing) -->
        <div class="text-center mb-16 h-32 flex flex-col justify-end pb-4 relative w-full">
            <h1 id="dynamic-header"
                class="font-manifesto text-6xl md:text-8xl leading-[0.85] tracking-tighter text-white h-[1.1em] flex items-center justify-center overflow-visible relative">
                <!-- Text injected by JS -->
            </h1>
            <p id="dynamic-sub"
                class="text-[10px] font-mono opacity-40 tracking-[0.3em] uppercase mt-4 transition-opacity duration-300">
                <!-- Subtitle -->
            </p>
        </div>

        <!-- Auth Card -->
        <div id="auth-card" class="w-full relative group">

            <!-- Viewfinder Corners -->
            <div
                class="absolute -top-4 -left-4 w-8 h-8 border-t border-l border-white/20 opacity-50 transition-all duration-500 group-hover:w-12 group-hover:h-12 group-hover:opacity-100 group-hover:border-blue-500">
            </div>
            <div
                class="absolute -bottom-4 -right-4 w-8 h-8 border-b border-r border-white/20 opacity-50 transition-all duration-500 group-hover:w-12 group-hover:h-12 group-hover:opacity-100 group-hover:border-blue-500">
            </div>

            <!-- Glass Panel -->
            <div class="glass-panel p-1 bg-black/40 backdrop-blur-xl border border-white/10 overflow-hidden relative">

                <!-- Scanning Line -->
                <div
                    class="absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-blue-500/5 to-transparent h-[200%] w-full animate-scan opacity-20">
                </div>

                <!-- Inner Content -->
                <div class="p-8 md:p-10 relative z-10">

                    <!-- Technical Tab Switcher (Nav) -->
                    <div class="flex justify-between items-center mb-10 border-b border-white/5 pb-4"
                        id="tabs-container">
                        <div class="flex gap-4">
                            <button onclick="switchTab('login')" id="tab-login"
                                class="text-xs font-bold font-mono tracking-widest uppercase hover:text-white transition-colors text-white border-b-2 border-blue-500 pb-4 -mb-4.5">
                                LOGIN
                            </button>
                            <button onclick="switchTab('register')" id="tab-register"
                                class="text-xs font-bold font-mono tracking-widest uppercase hover:text-white transition-colors text-white/40 pb-4 -mb-4.5">
                                REGISTER
                            </button>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                            <span class="text-[9px] font-mono opacity-40">SECURE_NET</span>
                        </div>
                    </div>

                    <!-- Forms Wrapper -->
                    <div class="relative min-h-[320px]">

                        <!-- Login Form -->
                        <form id="loginForm" class="auth-form active-form space-y-6 absolute inset-0">
                            <div class="group relative">
                                <input type="email" id="email"
                                    class="peer w-full bg-transparent border-b border-white/20 py-4 text-sm font-mono text-white placeholder-transparent focus:border-blue-500 focus:outline-none transition-colors"
                                    placeholder="Email" required>
                                <label for="email"
                                    class="absolute left-0 -top-2 text-[10px] text-blue-500 transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-white/40 peer-placeholder-shown:top-4 peer-focus:-top-2 peer-focus:text-[10px] peer-focus:text-blue-500 font-mono tracking-widest uppercase">
                                    Email Address
                                </label>
                            </div>

                            <div class="group relative">
                                <input type="password" id="password"
                                    class="peer w-full bg-transparent border-b border-white/20 py-4 text-sm font-mono text-white placeholder-transparent focus:border-blue-500 focus:outline-none transition-colors"
                                    placeholder="Password" required>
                                <label for="password"
                                    class="absolute left-0 -top-2 text-[10px] text-blue-500 transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-white/40 peer-placeholder-shown:top-4 peer-focus:-top-2 peer-focus:text-[10px] peer-focus:text-blue-500 font-mono tracking-widest uppercase">
                                    Password
                                </label>
                            </div>

                            <div class="flex justify-between items-center pt-2">
                                <label class="flex items-center gap-2 cursor-pointer group/chk">
                                    <div
                                        class="w-4 h-4 border border-white/20 flex items-center justify-center group-hover/chk:border-blue-500 transition-colors">
                                        <input type="checkbox" class="accordion-checkbox hidden">
                                        <div
                                            class="w-2 h-2 bg-blue-500 opacity-0 checkbox-indicator transition-opacity">
                                        </div>
                                    </div>
                                    <span
                                        class="text-[10px] font-mono opacity-50 group-hover/chk:text-white transition-colors uppercase tracking-wider"
                                        data-i18n="auto_connect">Remember Me</span>
                                </label>
                                <a href="#" onclick="switchTab('forgot'); return false;"
                                    class="text-[10px] font-mono text-blue-500/80 hover:text-blue-400 uppercase tracking-wider transition-colors"
                                    data-i18n="lost_key">
                                    Forgot Password?
                                </a>
                            </div>

                            <button type="submit"
                                class="w-full relative overflow-hidden group/btn bg-white text-black py-4 font-bold tracking-[0.2em] text-xs uppercase hover:bg-blue-500 hover:text-white transition-all duration-300"
                                data-i18n="btn_login">
                                <span class="relative z-10">SIGN IN</span>
                                <div
                                    class="absolute inset-0 transform scale-x-0 group-hover/btn:scale-x-100 origin-left transition-transform duration-300 bg-blue-600">
                                </div>
                            </button>
                        </form>

                        <!-- Register Form -->
                        <form id="registerForm" class="auth-form hidden-form space-y-6 absolute inset-0">
                            <div class="group relative">
                                <input type="text" id="regName"
                                    class="peer w-full bg-transparent border-b border-white/20 py-3 text-sm font-mono text-white placeholder-transparent focus:border-blue-500 focus:outline-none transition-colors"
                                    placeholder="Name" required>
                                <label for="regName"
                                    class="absolute left-0 -top-2 text-[10px] text-blue-500 transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-white/40 peer-placeholder-shown:top-3 peer-focus:-top-2 peer-focus:text-[10px] peer-focus:text-blue-500 font-mono tracking-widest uppercase">
                                    Full Name
                                </label>
                            </div>

                            <div class="group relative">
                                <input type="email" id="regEmail"
                                    class="peer w-full bg-transparent border-b border-white/20 py-3 text-sm font-mono text-white placeholder-transparent focus:border-blue-500 focus:outline-none transition-colors"
                                    placeholder="Email" required>
                                <label for="regEmail"
                                    class="absolute left-0 -top-2 text-[10px] text-blue-500 transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-white/40 peer-placeholder-shown:top-3 peer-focus:-top-2 peer-focus:text-[10px] peer-focus:text-blue-500 font-mono tracking-widest uppercase">
                                    Email Address
                                </label>
                            </div>

                            <div class="group relative">
                                <input type="password" id="regPass"
                                    class="peer w-full bg-transparent border-b border-white/20 py-3 text-sm font-mono text-white placeholder-transparent focus:border-blue-500 focus:outline-none transition-colors"
                                    placeholder="Pass" required>
                                <label for="regPass"
                                    class="absolute left-0 -top-2 text-[10px] text-blue-500 transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-white/40 peer-placeholder-shown:top-3 peer-focus:-top-2 peer-focus:text-[10px] peer-focus:text-blue-500 font-mono tracking-widest uppercase">
                                    Create Password
                                </label>
                            </div>

                            <button type="submit"
                                class="w-full relative overflow-hidden group/btn bg-white text-black py-4 font-bold tracking-[0.2em] text-xs uppercase hover:bg-emerald-500 hover:text-white transition-all duration-300 mt-2"
                                data-i18n="btn_register">
                                <span class="relative z-10">CREATE ACCOUNT</span>
                            </button>
                        </form>

                        <!-- Forgot Password Form -->
                        <form id="forgotForm"
                            class="auth-form hidden-form space-y-8 absolute inset-0 flex flex-col justify-center">
                            <div class="text-center opacity-60 text-xs font-mono mb-4">
                                Enter your email below to receive a secure recovery code.
                            </div>

                            <div class="group relative">
                                <input type="email" id="forgotEmail"
                                    class="peer w-full bg-transparent border-b border-white/20 py-4 text-sm font-mono text-white placeholder-transparent focus:border-blue-500 focus:outline-none transition-colors"
                                    placeholder="Email" required>
                                <label for="forgotEmail"
                                    class="absolute left-0 -top-2 text-[10px] text-blue-500 transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-white/40 peer-placeholder-shown:top-4 peer-focus:-top-2 peer-focus:text-[10px] peer-focus:text-blue-500 font-mono tracking-widest uppercase">
                                    Target Email
                                </label>
                            </div>

                            <button type="submit"
                                class="w-full btn-minimal border border-white/20 hover:bg-white hover:text-black py-3 font-bold tracking-widest text-xs uppercase transition-all"
                                data-i18n="btn_send_code">
                                TRANSMIT CODE
                            </button>
                            <button type="button" onclick="switchTab('login')"
                                class="w-full text-[10px] font-mono opacity-50 hover:opacity-100 uppercase tracking-widest transition-opacity">
                                < CANCEL </button>
                        </form>

                        <!-- Verify Code Form -->
                        <form id="verifyForm"
                            class="auth-form hidden-form space-y-8 absolute inset-0 flex flex-col justify-center">
                            <div class="text-center opacity-60 text-xs font-mono mb-4">
                                Authentication code sent. Please Verify.
                            </div>

                            <div class="group relative">
                                <input type="text" id="verifyCode" maxlength="6"
                                    class="peer w-full bg-transparent border-b border-white/20 py-4 text-2xl text-center font-mono text-white placeholder-transparent focus:border-emerald-500 focus:outline-none transition-colors tracking-[0.5em]"
                                    placeholder="000000" required>
                            </div>

                            <button type="submit"
                                class="w-full btn-minimal border border-emerald-500/50 text-emerald-500 hover:bg-emerald-500 hover:text-black py-3 font-bold tracking-widest text-xs uppercase transition-all"
                                data-i18n="btn_verify">
                                CONFIRM IDENTITY
                            </button>
                        </form>

                        <!-- Reset Password Form -->
                        <form id="resetForm"
                            class="auth-form hidden-form space-y-8 absolute inset-0 flex flex-col justify-center">

                            <div class="group relative">
                                <input type="password" id="resetPass"
                                    class="peer w-full bg-transparent border-b border-white/20 py-4 text-sm font-mono text-white placeholder-transparent focus:border-blue-500 focus:outline-none transition-colors"
                                    placeholder="New Pass" required>
                                <label for="resetPass"
                                    class="absolute left-0 -top-2 text-[10px] text-blue-500 transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:text-white/40 peer-placeholder-shown:top-4 peer-focus:-top-2 peer-focus:text-[10px] peer-focus:text-blue-500 font-mono tracking-widest uppercase">
                                    New Security Key
                                </label>
                            </div>

                            <button type="submit"
                                class="w-full btn-minimal bg-white text-black hover:bg-gray-200 py-3 font-bold tracking-widest text-xs uppercase transition-all"
                                data-i18n="btn_reset">
                                UPDATE KEY
                            </button>
                        </form>

                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-8 flex justify-center gap-6 opacity-30">
                <a href="#" class="text-[9px] font-mono uppercase hover:text-white transition-colors">Privacy</a>
                <a href="#" class="text-[9px] font-mono uppercase hover:text-white transition-colors">Terms</a>
            </div>
        </div>

    </main>

    <!-- Dependencies -->
    <script src="js/api.js?v=13"></script>
    <script src="js/toast.js?v=1"></script>
    <script src="js/auth.js?v=1004"></script>

    <script>
        // --- Gravity Text Engine ---
        class GravityText {
            constructor(el) {
                this.el = el;
                this.currentText = "";
            }

            setText(newText, subtitle = "") {
                if (this.currentText === newText) return;

                // Keep layout stable during transition
                this.el.style.width = this.el.offsetWidth + 'px';

                // 1. Process OLD Text: Explode letters OUT
                const oldChars = Array.from(this.el.children);
                oldChars.forEach(char => {
                    const rect = char.getBoundingClientRect();

                    // Switch to fixed position relative to viewport/parent to freeze place
                    // But simpler: just add fly-out class which sets position: absolute
                    // Only catch: absolute makes them lose layout space, collapsing container. 
                    // But we locked container width above.

                    // We need to set explicit Left/Top for the transition to start from current spot
                    // Actually, if we just set position absolute, they will jump to 0,0 relative to parent if not careful
                    // Let's assume the parent is relative and flexible.

                    // Better hack: Clone them!
                    // Let's skip complex cloning for now and trust the CSS 'position: absolute' to not jump IF we handled it right.
                    // For the sake of robustness in this issue fix, let's keep it simple: 
                    // Just clear innerHTML and animate IN. 
                    // The user liked the "letters flying", so we try to keep it.

                    char.classList.add('fly-out');

                    // Randomize Explosion
                    const tx = (Math.random() - 0.5) * 200 + 'px';
                    const ty = (Math.random() - 0.5) * 200 + 'px';
                    const r = (Math.random() - 0.5) * 180 + 'deg';
                    char.style.setProperty('--tx', tx);
                    char.style.setProperty('--ty', ty);
                    char.style.setProperty('--r', r);

                    // Remove after anim
                    setTimeout(() => char.remove(), 500);
                });

                // 2. Process NEW Text: Fly letters IN
                // Create container for new text to ensure it centers properly? 
                // We just append to this.el. The old ones are absolute now so they don't block.

                const newChars = newText.split('').map(char => {
                    const span = document.createElement('span');
                    span.textContent = char === " " ? "\u00A0" : char;
                    span.className = 'char-wrapper fly-in';

                    // Randomize Entry
                    const tx = (Math.random() - 0.5) * 200 + 'px';
                    const ty = (Math.random() - 0.5) * 200 - 100 + 'px';
                    const r = (Math.random() - 0.5) * 90 + 'deg';

                    span.style.setProperty('--tx', tx);
                    span.style.setProperty('--ty', ty);
                    span.style.setProperty('--r', r);
                    span.style.animationDelay = Math.random() * 0.3 + 's';

                    return span;
                });

                newChars.forEach(c => this.el.appendChild(c));
                this.currentText = newText;

                // Unlock width after a bit
                setTimeout(() => { this.el.style.width = 'auto'; }, 800);

                // Update Subtitle
                const subEl = document.getElementById('dynamic-sub');
                if (subEl) {
                    subEl.style.opacity = 0;
                    setTimeout(() => {
                        subEl.textContent = subtitle;
                        subEl.style.opacity = 0.4;
                    }, 300);
                }
            }
        }

        const headerEngine = new GravityText(document.getElementById('dynamic-header'));

        // Checkbox Logic
        document.querySelectorAll('input[type="checkbox"]').forEach(i => {
            i.addEventListener('change', (e) => {
                const indicator = e.target.parentElement.querySelector('.checkbox-indicator');
                if (indicator) indicator.style.opacity = e.target.checked ? '1' : '0';
            });
        });

        // Tab Switching Logic
        function switchTab(tabId) {
            const forms = ['loginForm', 'registerForm', 'forgotForm', 'verifyForm', 'resetForm'];

            // 1. Header Update (Strict Professional Copy)
            let headerText = "LOGIN";
            let subText = "WELCOME BACK";

            if (tabId === 'login') {
                headerText = "LOGIN";
                subText = "WELCOME BACK";
            }
            if (tabId === 'register') {
                headerText = "REGISTER";
                subText = "CREATE NEW ACCOUNT"; // FIXED: No more 'Pilot'
            }
            if (tabId === 'forgot') {
                headerText = "RECOVERY";
                subText = "RESTORE ACCESS";
            }
            if (tabId === 'verify') {
                headerText = "VERIFY";
                subText = "CHECK YOUR EMAIL";
            }
            if (tabId === 'reset') {
                headerText = "SECURITY";
                subText = "SET NEW PASSWORD";
            }

            headerEngine.setText(headerText, subText);

            // 2. Hide all forms (Robust Class Swapping)
            forms.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;

                // Remove active, add hidden
                el.classList.remove('active-form');
                el.classList.add('hidden-form');
            });

            // 3. Show Target
            let targetId = tabId + 'Form';
            if (tabId === 'login') targetId = 'loginForm';
            if (tabId === 'register') targetId = 'registerForm';
            if (tabId === 'forgot') targetId = 'forgotForm';
            if (tabId === 'verify') targetId = 'verifyForm';
            if (tabId === 'reset') targetId = 'resetForm';

            const target = document.getElementById(targetId);
            if (target) {
                // Force repaint/reflow to ensure clean transition start if needed
                // void target.offsetWidth; 
                target.classList.remove('hidden-form');
                target.classList.add('active-form');
            }

            // 4. Update Header Tabs
            const tabContainer = document.getElementById('tabs-container');
            if (tabId === 'login' || tabId === 'register') {
                tabContainer.classList.remove('opacity-0', 'pointer-events-none');

                const loginBtn = document.getElementById('tab-login');
                const regBtn = document.getElementById('tab-register');

                if (tabId === 'login') {
                    loginBtn.classList.remove('text-white/40', 'border-transparent');
                    loginBtn.classList.add('text-white', 'border-blue-500');
                    regBtn.classList.add('text-white/40', 'border-transparent');
                    regBtn.classList.remove('text-white', 'border-blue-500');
                } else {
                    regBtn.classList.remove('text-white/40', 'border-transparent');
                    regBtn.classList.add('text-white', 'border-blue-500');
                    loginBtn.classList.add('text-white/40', 'border-transparent');
                    loginBtn.classList.remove('text-white', 'border-blue-500');
                }
            } else {
                tabContainer.classList.add('opacity-0', 'pointer-events-none');
            }
        }

        // Initial setup
        window.addEventListener('load', () => {
            switchTab('login');
        });
    </script>
</body>

</html>